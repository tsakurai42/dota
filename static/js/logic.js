TIInviteeID = [1838315, 726228, 1883502, 39, 15, 2163, 350190, 6214973, 2108395, 2586976, 111474, 2626685]
heroIcons = {
    'Abaddon': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/2/26/Abaddon_icon.png/120px-Abaddon_icon.png',
    'Alchemist': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/f/fe/Alchemist_icon.png/120px-Alchemist_icon.png',
    'Ancient Apparition': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/6/67/Ancient_Apparition_icon.png/120px-Ancient_Apparition_icon.png',
    'Anti-Mage': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/8/8e/Anti-Mage_icon.png/120px-Anti-Mage_icon.png', 'Arc Warden': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/0/07/Arc_Warden_icon.png/120px-Arc_Warden_icon.png', 'Axe': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/2/23/Axe_icon.png/120px-Axe_icon.png', 'Bane': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/c/c3/Bane_icon.png/120px-Bane_icon.png', 'Batrider': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/f/f2/Batrider_icon.png/120px-Batrider_icon.png', 'Beastmaster': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/d9/Beastmaster_icon.png/120px-Beastmaster_icon.png', 'Bloodseeker': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/5/56/Bloodseeker_icon.png/120px-Bloodseeker_icon.png', 'Bounty Hunter': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/a/a6/Bounty_Hunter_icon.png/120px-Bounty_Hunter_icon.png', 'Brewmaster': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/1e/Brewmaster_icon.png/120px-Brewmaster_icon.png', 'Bristleback': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/4/4d/Bristleback_icon.png/120px-Bristleback_icon.png', 'Broodmother': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/df/Broodmother_icon.png/120px-Broodmother_icon.png', 'Centaur Warrunner': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/e/ed/Centaur_Warrunner_icon.png/120px-Centaur_Warrunner_icon.png', 'Chaos Knight': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/f/fe/Chaos_Knight_icon.png/120px-Chaos_Knight_icon.png', 'Chen': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/6/61/Chen_icon.png/120px-Chen_icon.png', 'Clinkz': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/c/cb/Clinkz_icon.png/120px-Clinkz_icon.png', 'Clockwerk': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/d8/Clockwerk_icon.png/120px-Clockwerk_icon.png', 'Crystal Maiden': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/2/27/Crystal_Maiden_icon.png/120px-Crystal_Maiden_icon.png', 'Dark Seer': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/c/c5/Dark_Seer_icon.png/120px-Dark_Seer_icon.png', 'Dark Willow': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/3/3c/Dark_Willow_icon.png/120px-Dark_Willow_icon.png', 'Dazzle': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/e/e6/Dazzle_icon.png/120px-Dazzle_icon.png', 'Death Prophet': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/d7/Death_Prophet_icon.png/120px-Death_Prophet_icon.png', 'Disruptor': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/9/97/Disruptor_icon.png/120px-Disruptor_icon.png', 'Doom': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/4/40/Doom_icon.png/120px-Doom_icon.png', 'Dragon Knight': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/5/59/Dragon_Knight_icon.png/120px-Dragon_Knight_icon.png', 'Drow Ranger': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/8/80/Drow_Ranger_icon.png/120px-Drow_Ranger_icon.png', 'Earth Spirit': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/b/be/Earth_Spirit_icon.png/120px-Earth_Spirit_icon.png', 'Earthshaker': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/a/a5/Earthshaker_icon.png/120px-Earthshaker_icon.png', 'Elder Titan': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/1a/Elder_Titan_icon.png/120px-Elder_Titan_icon.png', 'Ember Spirit': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/9/91/Ember_Spirit_icon.png/120px-Ember_Spirit_icon.png', 'Enchantress': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/4/41/Enchantress_icon.png/120px-Enchantress_icon.png', 'Enigma': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/f/f7/Enigma_icon.png/120px-Enigma_icon.png', 'Faceless Void': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/7/73/Faceless_Void_icon.png/120px-Faceless_Void_icon.png', 'Grimstroke': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/d7/Grimstroke_icon.png/120px-Grimstroke_icon.png', 'Gyrocopter': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/4/4f/Gyrocopter_icon.png/120px-Gyrocopter_icon.png', 'Huskar': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/d3/Huskar_icon.png/120px-Huskar_icon.png', 'Invoker': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/0/00/Invoker_icon.png/120px-Invoker_icon.png', 'Io': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/8/8d/Io_icon.png/120px-Io_icon.png', 'Jakiro': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/2/2f/Jakiro_icon.png/120px-Jakiro_icon.png', 'Juggernaut': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/0/03/Juggernaut_icon.png/120px-Juggernaut_icon.png', 'Keeper of the Light': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/b/b9/Keeper_of_the_Light_icon.png/120px-Keeper_of_the_Light_icon.png', 'Kunkka': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/c/c0/Kunkka_icon.png/120px-Kunkka_icon.png', 'Legion Commander': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/a/a2/Legion_Commander_icon.png/120px-Legion_Commander_icon.png', 'Leshrac': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/2/26/Leshrac_icon.png/120px-Leshrac_icon.png', 'Lich': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/b/bb/Lich_icon.png/120px-Lich_icon.png', 'Lifestealer': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/2/2b/Lifestealer_icon.png/120px-Lifestealer_icon.png', 'Lina': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/3/35/Lina_icon.png/120px-Lina_icon.png', 'Lion': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/b/b8/Lion_icon.png/120px-Lion_icon.png', 'Lone Druid': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/5/5d/Lone_Druid_icon.png/120px-Lone_Druid_icon.png', 'Luna': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/7/7d/Luna_icon.png/120px-Luna_icon.png', 'Lycan': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/d6/Lycan_icon.png/120px-Lycan_icon.png', 'Magnus': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/b/ba/Magnus_icon.png/120px-Magnus_icon.png', 'Mars': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/9/9d/Mars_icon.png/120px-Mars_icon.png', 'Medusa': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/c/cc/Medusa_icon.png/120px-Medusa_icon.png', 'Meepo': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/8/85/Meepo_icon.png/120px-Meepo_icon.png', 'Mirana': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/12/Mirana_icon.png/120px-Mirana_icon.png', 'Monkey King': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/7/7b/Monkey_King_icon.png/120px-Monkey_King_icon.png', 'Morphling': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/7/7b/Morphling_icon.png/120px-Morphling_icon.png', 'Naga Siren': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/6/60/Naga_Siren_icon.png/120px-Naga_Siren_icon.png', "Nature's Prophet": 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/c/c4/Nature%27s_Prophet_icon.png/120px-Nature%27s_Prophet_icon.png', 'Necrophos': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/a/a6/Necrophos_icon.png/120px-Necrophos_icon.png', 'Night Stalker': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/15/Night_Stalker_icon.png/120px-Night_Stalker_icon.png', 'Nyx Assassin': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/f/fa/Nyx_Assassin_icon.png/120px-Nyx_Assassin_icon.png', 'Ogre Magi': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/e/e0/Ogre_Magi_icon.png/120px-Ogre_Magi_icon.png', 'Omniknight': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/e/e2/Omniknight_icon.png/120px-Omniknight_icon.png', 'Oracle': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/7/72/Oracle_icon.png/120px-Oracle_icon.png', 'Outworld Devourer': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/9/99/Outworld_Devourer_icon.png/120px-Outworld_Devourer_icon.png', 'Pangolier': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/4/4e/Pangolier_icon.png/120px-Pangolier_icon.png', 'Phantom Assassin': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/8/8e/Phantom_Assassin_icon.png/120px-Phantom_Assassin_icon.png', 'Phantom Lancer': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/8/81/Phantom_Lancer_icon.png/120px-Phantom_Lancer_icon.png', 'Phoenix': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/14/Phoenix_icon.png/120px-Phoenix_icon.png', 'Puck': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/13/Puck_icon.png/120px-Puck_icon.png', 'Pudge': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/c/c0/Pudge_icon.png/120px-Pudge_icon.png', 'Pugna': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/c/cd/Pugna_icon.png/120px-Pugna_icon.png', 'Queen of Pain': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/a/a1/Queen_of_Pain_icon.png/120px-Queen_of_Pain_icon.png', 'Razor': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/6/66/Razor_icon.png/120px-Razor_icon.png', 'Riki': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/7/7d/Riki_icon.png/120px-Riki_icon.png', 'Rubick': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/8/8a/Rubick_icon.png/120px-Rubick_icon.png', 'Sand King': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/7/79/Sand_King_icon.png/120px-Sand_King_icon.png', 'Shadow Demon': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/f/f3/Shadow_Demon_icon.png/120px-Shadow_Demon_icon.png', 'Shadow Fiend': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/3/36/Shadow_Fiend_icon.png/120px-Shadow_Fiend_icon.png', 'Shadow Shaman': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/9/96/Shadow_Shaman_icon.png/120px-Shadow_Shaman_icon.png', 'Silencer': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/9/9f/Silencer_icon.png/120px-Silencer_icon.png', 'Skeleton King': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/0/07/Skeleton_King_icon.png/120px-Skeleton_King_icon.png', 'Skywrath Mage': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/b/bf/Skywrath_Mage_icon.png/120px-Skywrath_Mage_icon.png', 'Slardar': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/7/7e/Slardar_icon.png/120px-Slardar_icon.png', 'Slark': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/a/aa/Slark_icon.png/120px-Slark_icon.png', 'Sniper': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/5/51/Sniper_icon.png/120px-Sniper_icon.png', 'Spectre': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/f/ff/Spectre_icon.png/120px-Spectre_icon.png', 'Spirit Breaker': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/df/Spirit_Breaker_icon.png/120px-Spirit_Breaker_icon.png', 'Storm Spirit': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/13/Storm_Spirit_icon.png/120px-Storm_Spirit_icon.png', 'Sven': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/1b/Sven_icon.png/120px-Sven_icon.png', 'Techies': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/f/fa/Techies_icon.png/120px-Techies_icon.png', 'Templar Assassin': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/9/9c/Templar_Assassin_icon.png/120px-Templar_Assassin_icon.png', 'Terrorblade': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/5/52/Terrorblade_icon.png/120px-Terrorblade_icon.png', 'Tidehunter': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/d5/Tidehunter_icon.png/120px-Tidehunter_icon.png', 'Timbersaw': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/9/9a/Timbersaw_icon.png/120px-Timbersaw_icon.png', 'Tinker': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/d/d1/Tinker_icon.png/120px-Tinker_icon.png', 'Tiny': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/5/55/Tiny_icon.png/120px-Tiny_icon.png', 'Treant Protector': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/3/3f/Treant_Protector_icon.png/120px-Treant_Protector_icon.png', 'Troll Warlord': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/f/f0/Troll_Warlord_icon.png/120px-Troll_Warlord_icon.png', 'Tusk': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/c/ce/Tusk_icon.png/120px-Tusk_icon.png', 'Underlord': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/18/Underlord_icon.png/120px-Underlord_icon.png', 'Undying': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/6/61/Undying_icon.png/120px-Undying_icon.png', 'Ursa': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/4/40/Ursa_icon.png/120px-Ursa_icon.png', 'Vengeful Spirit': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/2/20/Vengeful_Spirit_icon.png/120px-Vengeful_Spirit_icon.png', 'Venomancer': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/2/25/Venomancer_icon.png/120px-Venomancer_icon.png', 'Viper': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/5/5f/Viper_icon.png/120px-Viper_icon.png', 'Visage': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/9/9e/Visage_icon.png/120px-Visage_icon.png', 'Warlock': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/3/3f/Warlock_icon.png/120px-Warlock_icon.png', 'Weaver': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/0/09/Weaver_icon.png/120px-Weaver_icon.png', 'Windranger': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/6/60/Windranger_icon.png/120px-Windranger_icon.png', 'Winter Wyvern': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/4/4a/Winter_Wyvern_icon.png/120px-Winter_Wyvern_icon.png', 'Witch Doctor': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/3/33/Witch_Doctor_icon.png/120px-Witch_Doctor_icon.png', 'Wraith King': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/1/1e/Wraith_King_icon.png/120px-Wraith_King_icon.png', 'Zeus': 'https://gamepedia.cursecdn.com/dota2_gamepedia/thumb/3/3f/Zeus_icon.png/120px-Zeus_icon.png'
}
margin = {
    'left': 50,
    'top': 25
}

d3.json('/topteams').then(data => {
    // console.log(data)
    teamd3 = d3.select('#topteamsselect')
    teamd3.selectAll('option')
        .data(data)
        .enter()
        .append('option')
        .text(d => {
            if (TIInviteeID.includes(d.team_id)) {
                return `!!!${d.name} @ ${d.rating}!!!`
            } else {
                return `${d.name} @ ${d.rating}`
            }
        })
        .attr('value', d => `${d['team_id']},${d.name}`)
    // .attr('data-teamname', d=> d.name)
    teamd3.on('change', function () {
        // console.log(this.options[this.selectedIndex].attr('data-teamname'))
        changeTeam(this.value)
    })
})
chartWidth = 600;
chartHeight = 400;
var svg = d3.select('#players').append('svg').attr('height', 500).attr('width', 700)
var chartGroup = svg.append('g')
    .attr('transform', `translate(${margin.left},${margin.top})`)
    .classed('chart', true)
xAxisGroup = chartGroup.append('g')
    .attr('transform', `translate(0, ${chartHeight})`)
yAxisGroup = chartGroup.append('g')

var yScale = d3.scaleLinear().domain([0, 1]).range([chartHeight, 0])
var yAxis = d3.axisLeft(yScale);

var svgheroes = d3.select('#heroes').append('svg').attr('height', 500).attr('width', 700)
var chartGroupheroes = svgheroes.append('g')
    .attr('transform', `translate(${margin.left},${margin.top})`)
    .classed('heroeschart', true)
xAxisGroupHeroes = chartGroupheroes.append('g')
    .attr('transform', `translate(0, ${chartHeight})`)
yAxisGroupHeroes = chartGroupheroes.append('g')

var yScaleHeroes = d3.scaleLinear().domain([0, 100]).range([chartHeight, 0])
var yAxisHeroes = d3.axisLeft(yScaleHeroes);

svgheroes.append("text")
    .attr("transform",
        `translate(${((chartWidth + margin.left) / 2)},${(chartHeight + margin.top + 30)})`)
    .style("text-anchor", "middle")
    .text("Picks");

svgheroes.append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 0)
    .attr("x", 0 - (chartHeight / 2))
    .attr("dy", "1em")
    .style("text-anchor", "middle")
    .text("Value");

changeTeam('1838315,Team Secret');

function changeTeam(team_id) {
    // console.log(team_id.split(','))
    var [team_id, team_name] = team_id.split(',')
    // console.log(team_id,team_name)
    d3.json(`/playersontopteams/${team_id}`).then(data => {
        var xScale = d3.scaleBand().domain(data.map(k => k.name)).range([0, chartWidth]).padding(0.1)
        var xAxis = d3.axisBottom(xScale)
        yAxisGroup.call(yAxis)
        xAxisGroup.call(xAxis)
        // chartGroup.selectAll('.bar').remove()
        // console.log(data)
        var $barGroup = d3.select('.chart').selectAll('.bar')
            .data(data);
        $barGroup
            .enter()
            .append('rect')
            .merge($barGroup)
            .attr('x', d => xScale(d.name))
            .attr('y', d => yScale(d.wins / d.games_played))
            .attr('width', xScale.bandwidth())
            .attr('height', d => chartHeight - yScale(d.wins / d.games_played))
            .classed('bar', true)
        $barGroup
            .exit()
            .remove()

        var $textGroup = d3.select('.chart').selectAll('.bartext')
            .data(data);
        $textGroup
            .enter()
            .append('text')
            .merge($textGroup)
            .attr('text-anchor', 'middle')
            .attr('x', d => xScale(d.name) + xScale.bandwidth() / 2)
            .attr('y', d => yScale(d.wins / d.games_played) - 10)
            .attr('width', xScale.bandwidth())
            .attr('height', d => chartHeight - yScale(d.wins / d.games_played))
            .text(d => `${d.wins}/${d.games_played} ${(100 * d.wins / d.games_played).toFixed(2)}%`)
            .classed('bartext', true)
        $textGroup
            .exit()
            .remove()
    })
    d3.json(`/teamherostats/${team_id}`).then(data => {
        // console.log(data)
        // console.log(Object.entries(data).map(k=>k[1].games_played))
        var xScaleHeroes = d3.scaleLinear().domain([0, d3.max(Object.entries(data).map(k => k[1].games_played))]).range([0, chartWidth])
        var xAxisHeroes = d3.axisBottom(xScaleHeroes)
        yAxisGroupHeroes.call(yAxisHeroes)
        xAxisGroupHeroes.call(xAxisHeroes)
        var newdata = d3.entries(data);
        // console.log(newdata)
        var tooltipoverall = d3.select('#heroestooltip').style('position', 'absolute')
            .style('background', '#fff')
            .style('border-radius', '8px')
            .style('border', '2px solid black')
            .style('left', '0px')
            .style('top', '0px')
            .style('padding', '5px')
            .style('display', 'none')
        tooltipoverall.html(null)
        var tooltiptext = tooltipoverall.append('div')
        var tooltipbg = tooltipoverall.append('div')
        var $circlesGroup = d3.select('.heroeschart').selectAll('.hero-circles')
            .data(newdata);

        $circlesGroup
            .enter()
            .append('circle')
            .merge($circlesGroup)
            .attr('r', 5)
            .attr('data-heroname', d => d.value.localized_name)
            .classed('hero-circles', true)
            .on('mouseover', function (d) {
                console.log('hi')
                tooltipoverall
                    .style('display', 'block')
                    .style('left', `${parseInt(d3.select(this).attr('cx'))}px`)
                    .style('top', `${parseInt(d3.select(this).attr('cy')) + 450}px`)
                tooltipbg
                    .style('background-image', `url("${heroIcons[d.value.localized_name]}")`)
                    .style('background-size', 'cover')
                    .style('opacity', '0.3')
                    .style('position', 'absolute')
                    .style('top', '0')
                    .style('left', '0')
                    .style('width', '100%')
                    .style('height', '100%')
                tooltiptext
                    .style('z-index', '1')
                    .html(`${d.value.localized_name}<br>Picks: ${d.value.games_played}<br>Wins: ${d.value.wins}<br>Win %: ${(100 * d.value.wins / d.value.games_played).toFixed(1)}%`)

            })
            .on('mouseout', function () {
                tooltipoverall.style('display', 'none')
            })
            .transition()
            .duration(1500)
            .attr('cx', d => xScaleHeroes(d.value.games_played))
            .attr('cy', d => yScaleHeroes(100 * d.value.wins / d.value.games_played))

        // $circlesGroup.on('mouseover', function (d) {
        //     console.log('hi!')
        //     console.log(parseInt(d3.select(this).attr('cx')))

        // })
        // $circlesGroup.on('mouseout', function () {
        //     tooltip.style('display', 'none')
        // })

        $circlesGroup
            .exit()
            .remove()
    })
    d3.json(`https://api.opendota.com/api/teams/${team_id}/matches`).then(data => {
        game = d3.select('#gameselect')
        game.html(null)
        game.selectAll('option')
            .data(data)
            .enter()
            .append('option')
            .text(d => `${team_name} vs ${d.opposing_team_name} at ${d.league_name}`)
            .attr('value', d => d['match_id'])
        game.on('change', function () {
            changeGame(this.value)
        })
        changeGame(data[0]['match_id'])
    })
}
posSvg = d3.select('#positions').append('svg').attr('height', '400px').attr('width', '400px')

function changeGame(game_id) {
    d3.json(`https://api.opendota.com/api/matches/${game_id}`).then(data => {
        positions = []
        player_order = {}
        data['players'].forEach(element => {
            // console.log(element['lane_pos'])
            for ([x, v] of Object.entries(element['lane_pos'])) {
                for (y of Object.keys(v)) {
                    temp_pos = {}
                    temp_pos['x'] = x
                    temp_pos['y'] = y
                    positions.push(temp_pos)
                }
            }
            // console.log(element)
            player_order[element['player_slot']] = element['hero_id']
            // console.log(x_pos,y_pos)

        })
        // console.log(player_order)
        // console.log(positions)
        deaths = []
        data['teamfights'].forEach(elementy => {
            // playercount = 0;
            // console.log(elementy)
            for ([kee, vall] of Object.entries(elementy['players'])) {
                each_death = {}
                // console.log(kee,vall)
                for ([k3, val3] of Object.entries(vall)) {
                    // console.log(k3, val3)
                    if (k3 == "deaths_pos" && Object.keys(val3).length != 0) {
                        // console.log('hihi')
                        each_death['time'] = elementy.start
                        if (kee <= 4) {
                            each_death['hero_id'] = parseInt(kee)
                        } else {
                            each_death['hero_id'] = parseInt(kee) + 128;
                        }

                        each_death['death_pos_x'] = parseInt(Object.keys(val3)[0])
                        each_death['death_pos_y'] = parseInt(Object.keys(Object.values(val3)[0])[0])
                        // console.log(each_death)
                        deaths.push(each_death)
                    }
                }
                // playercount++;
                // if (playercount==5) {
                //     playercount = 128;
                // }
            }
        })
        console.log(deaths)
        xScalePos = d3.scaleLinear().domain(d3.extent(positions.map(d => parseInt(d.x)))).range([25, 375])
        yScalePos = d3.scaleLinear().domain(d3.extent(positions.map(d => parseInt(d.y)))).range([375, 25])
        // d3.extent(positions.y)
        // d3.select('#positions').attr('background-image', 'url("detailed_720.webp")')
        // xProgress = d3.scaleLinear().domain([0,d3.max(deaths.map(d => d.time*2))]).range([0,400])
        animDuration = d3.max(deaths.map(d=>d.time*2))
        posSvg.html(null)
        d3.select('#progressbar').attr('width',0)
        posSvg.selectAll('#poscircle').data(deaths).enter().append('circle')
            .attr('cx', d => xScalePos(parseInt(d.death_pos_x)))
            .attr('cy', d => yScalePos(parseInt(d.death_pos_y)))
            .attr('r', 0)//'10')
            .attr('stroke', 'black')
            .attr('fill', d => {
                if (d.hero_id < 5) { //01234 are radiant, 128/129/130/131/132 are dire
                    return 'green'
                } else {
                    return 'red'
                }
            })
            .transition()
            .delay(d => d.time*2)
            .attr('r', 10)
        d3.select('#progressbar').data(deaths)
            .transition()
            .duration(animDuration)
            .ease(d3.easeLinear)
            .attr('width',400)
    });
}